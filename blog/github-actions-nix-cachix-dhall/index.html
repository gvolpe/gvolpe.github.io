<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <!--<meta name="viewport" content="width=device-width, initial-scale=1">--> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> <title> Github actions powered by Nix Shell & Cachix &bull; gvolpe's blog </title> <meta name="description" content="The more I learn about Nix - a purely functional package manager - the more I am convinced this is the way forward. Even if there’s still room for big improv..."> <link rel="icon" href="/images/favicon.png"> <link rel="canonical" href="https://gvolpe.github.io/blog/github-actions-nix-cachix-dhall/"> <link rel="alternate" type="application/rss+xml" title="gvolpe's blog" href="https://gvolpe.github.io/blog/feed.xml" /> <link rel="stylesheet" href="/css/main.css"> <link rel="stylesheet" href="/assets/css/main.css"/> <!--Also needs to be set in ./_layouts/unified.html--> <script defer data-domain="gvolpe.com" src="https://analytics.gvolpe.com/js/script.js"></script> <noscript><link rel="stylesheet" href="/assets/css/noscript.css" /></noscript> </head> <body class=""> <header id="header"> <h1> <a href="/blog">Gabriel Volpe's blog</a> </h1> <div class="overlay"> <div class="container"> <div class="darkmode-div"> <input type="checkbox" id="darkmode" onchange="darkModeEvent(this);"/> <label for="darkmode"> <div id="star"> <div class="star" id="star-1">★</div> <div class="star" id="star-2">★</div> </div> <div id="moon"></div> </label> </div> <nav> <ul> <li><a href="/">Home</a></li> <li><a href="/blog/categories/">Categories</a></li> </ul> </nav> </div> </div> <div id="progress-bar"></div> </header> <script type="text/javascript"> window.onload = function() { document.getElementById("darkmode").checked=false; }; window.onscroll = function() { var docElem = document.documentElement; var docBody = document.body; var scrollTop = docElem['scrollTop'] || docBody['scrollTop']; var scrollTop = docElem['scrollTop'] || docBody['scrollTop']; var scrollBottom = (docElem['scrollHeight'] || docBody['scrollHeight']) - window.innerHeight; var scrollPercent = scrollTop / scrollBottom * 100 + '%'; document.getElementById("progress-bar").style.setProperty("--scrollAmount", scrollPercent); }; function darkModeEvent(box) { var light = document.getElementById("blogpost"); var dark = document.getElementById("accessible"); if (box.checked && light != null) { light.id="accessible"; } if (!box.checked && dark != null) { dark.id="blogpost"; } return false; }; </script> <section id="blogpost" class="main style-post dark fullscreen"> <div class="content"> <div class="post-content"> <header class="post-header"> <h1 class="post-title">Github actions powered by Nix Shell & Cachix</h1> <span class="post-meta"> <time class="post-date" datetime="2020-06-02">Jun 2, 2020</time> <span class="post-author">by <a href="/">Gabriel Volpe</a></span> </span> <div class="post-categories"> <span class="post-meta"> <a href="/blog/categories/#ci" class="cat-link">ci</a> &nbsp; <a href="/blog/categories/#nix" class="cat-link">nix</a> &nbsp; <a href="/blog/categories/#cachix" class="cat-link">cachix</a> &nbsp; <a href="/blog/categories/#haskell" class="cat-link">haskell</a> &nbsp; <a href="/blog/categories/#scala" class="cat-link">scala</a> &nbsp; <a href="/blog/categories/#dhall" class="cat-link">dhall</a> </span> </div> </header> <p>The more I learn about <a href="https://nixos.org/nix/">Nix</a> - a purely functional package manager - the more I am convinced this is the way forward. Even if there’s still room for big improvements.</p> <p>Today I’d like to share with y’all what I’ve been up-to lately. Though, you could imagine I’ve been <em>Nixifying</em> more than one project ;)</p> <h3 id="nix-shell">Nix shell</h3> <p>Nix shell is a great tool to create reproducible development environments. For example, we could create a shell where the <code>redis</code> package is available, without installing it in our system.</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>nix-shell -p redis
<span class="o">[</span>nix-shell:~<span class="o">]</span><span class="nv">$ </span>redis-cli --version
redis-cli 6.0.3
<span class="o">[</span>nix-shell:~<span class="o">]</span><span class="nv">$ </span><span class="nb">exit</span>
<span class="nb">exit</span>
<span class="nv">$ </span>redis-cli --version
Command <span class="s1">&#39;redis-cli&#39;</span> not found</code></pre></div> <p>This is not <em>that reproducible</em> since different machines might be pointing to a different Nix channel, or to the same channel but using a different version. To guarantee reproducibility, we need to <a href="https://nixos.wiki/wiki/FAQ/Pinning_Nixpkgs">pin our nixpkgs</a> version.</p> <p>Nowadays, it is very common to provide a <code>shell.nix</code> per project, declaring the dependencies needed to build it. This comes in very handy since we can checkout a project, type <code>nix-shell</code> and we would be ready to build it. Furthermore, one could use <a href="https://github.com/nix-community/nix-direnv">nix-direnv</a> instead so that all the needed dependencies are available as soon as we cd into the directory (highly recommended).</p> <p>I’ve been following this practice in most of my projects, and this blog is not an exception. This is how its <code>shell.nix</code> is defined:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="k">let</span>
  <span class="ss">nixpkgs =</span> fetchTarball <span class="p">{</span>
    <span class="ss">name   =</span> <span class="s2">&quot;NixOS-unstable-13-05-2020&quot;</span><span class="p">;</span>
    <span class="ss">url    =</span> <span class="s2">&quot;https://github.com/NixOS/nixpkgs-channels/archive/6bcb1dec8ea.tar.gz&quot;</span><span class="p">;</span>
    <span class="ss">sha256 =</span> <span class="s2">&quot;04x750byjr397d3mfwkl09b2cz7z71fcykhvn8ypxrck8w7kdi1h&quot;</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> nixpkgs <span class="p">{};</span>

  <span class="ss">ruby =</span> pkgs<span class="o">.</span>ruby_2_7<span class="p">;</span>
  <span class="ss">rubygems =</span> <span class="p">(</span>pkgs<span class="o">.</span>rubygems<span class="o">.</span>override <span class="p">{</span> <span class="ss">ruby =</span> ruby<span class="p">;</span> <span class="p">});</span>

<span class="k">in</span> pkgs<span class="o">.</span>mkShell <span class="p">{</span>
  <span class="ss">buildInputs =</span> <span class="p">[</span>
    pkgs<span class="o">.</span>haskellPackages<span class="o">.</span>dhall-json <span class="c1"># v1.6.2</span>
    ruby <span class="c1"># v2.7.1p83</span>
  <span class="p">];</span>

  <span class="ss">shellHook =</span> <span class="s1">&#39;&#39;</span>
<span class="s1">    mkdir -p .nix-gems</span>
<span class="s1">    export GEM_HOME=$PWD/.nix-gems</span>
<span class="s1">    export GEM_PATH=$GEM_HOME</span>
<span class="s1">    export PATH=$GEM_HOME/bin:$PATH</span>
<span class="s1">  &#39;&#39;</span><span class="p">;</span>
<span class="p">}</span></code></pre></div> <p>If you have never seen one, this is what’s happening step by step:</p> <ol> <li><code>fetchTarball</code> gets the specified version of the <code>nixpkgs</code> as a tarball (reproducibility).</li> <li><code>rubygems</code> is overriding the <code>ruby</code> version of <code>nixpkgs</code> to match the one we need (<code>2.7.x</code>).</li> <li><code>pkgs.mkShell</code> should be self-explanatory; it creates a shell using the specified version of <code>nixpkgs</code>.</li> <li><code>buildInputs</code> defines the two dependencies needed to build the project. Actually, only <code>ruby</code> is needed to build the blog; <code>dhall-json</code> is only used locally to generate some YAML files.</li> <li><code>shellHook</code> allows us to run some commands to prepare the environment of our shell.</li> </ol> <p>Now anyone could clone this project on Github and build it locally using Nix. Reproducibility should be guaranteed (well, mostly(*)).</p> <p>(*) In a Ruby project, the best way to guarantee reproducibility is by using <a href="https://github.com/nix-community/bundix">bundix</a>, but I didn’t bother in using it just to build my blog. After all, I prefer to write code in statically-typed languages.</p> <h3 id="github-actions-powered-by-dhall">Github actions powered by Dhall</h3> <p>The curious reader might be thinking what are those YAML files we need to build. The answer is the YAML files needed by <a href="https://help.github.com/en/actions">Github actions</a>. Why not defining the YAML files directly? One may ask. The answer is I really <a href="https://noyaml.com/">dislike YAML files</a>.</p> <p>So there is <a href="https://dhall-lang.org/">Dhall</a>, which among other things, can generate YAML from a sane Dhall definition via the <code>dhall-to-yaml</code> program. This is how the CI build definition for this blog looks like:</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">let</span> <span class="kt">GithubActions</span> <span class="ow">=</span>
      <span class="n">https</span><span class="kt">://</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gvolpe</span><span class="o">/</span><span class="n">github</span><span class="o">-</span><span class="n">actions</span><span class="o">-</span><span class="n">dhall</span><span class="o">/</span><span class="n">steps</span><span class="o">/</span><span class="n">cachix</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">dhall</span> <span class="n">sha256</span><span class="kt">:</span><span class="mi">4</span><span class="n">cd8f64770d8b015c2fd52bae5ddfb5b393eb7e0936f7f8e18f311c591b888a5</span>

<span class="kr">let</span> <span class="n">setup</span> <span class="ow">=</span>
      <span class="p">[</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">checkout</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">cachix</span><span class="o">/</span><span class="n">install</span><span class="o">-</span><span class="n">nix</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">cachix</span><span class="o">/</span><span class="n">cachix</span> <span class="p">{</span> <span class="n">cache</span><span class="o">-</span><span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;gvolpe-blog&quot;</span> <span class="p">}</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">run</span>
          <span class="p">{</span> <span class="n">run</span> <span class="ow">=</span> <span class="s">&quot;nix-shell run -- </span><span class="se">\&quot;</span><span class="s">bundle install &amp;&amp; bundle exec jekyll build</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="p">}</span>
      <span class="p">]</span>

<span class="kr">in</span>  <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Workflow</span><span class="ow">::</span><span class="p">{</span>
    <span class="p">,</span> <span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;Blog&quot;</span>
    <span class="p">,</span> <span class="n">on</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">On</span><span class="ow">::</span><span class="p">{</span>
      <span class="p">,</span> <span class="n">pull_request</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">PullRequest</span><span class="ow">::</span><span class="p">{</span><span class="ow">=</span><span class="p">}</span>
      <span class="p">,</span> <span class="n">push</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Push</span><span class="ow">::</span><span class="p">{</span> <span class="n">branches</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="p">[</span> <span class="s">&quot;master&quot;</span> <span class="p">]</span> <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">,</span> <span class="n">jobs</span> <span class="ow">=</span> <span class="n">toMap</span>
        <span class="p">{</span> <span class="n">build</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Job</span><span class="ow">::</span><span class="p">{</span>
          <span class="p">,</span> <span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;build&quot;</span>
          <span class="p">,</span> <span class="n">needs</span> <span class="ow">=</span> <span class="kt">None</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Text</span><span class="p">)</span>
          <span class="p">,</span> <span class="n">runs</span><span class="o">-</span><span class="n">on</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="kt">RunsOn</span><span class="o">.</span><span class="p">`</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="p">`</span>
          <span class="p">,</span> <span class="n">steps</span> <span class="ow">=</span> <span class="n">setup</span>
          <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></div> <p>Besides giving us types, Dhall gives us <a href="http://www.haskellforall.com/2017/11/semantic-integrity-checks-are-next.html">semantic integrity checks</a>, which is a great and secure way of versioning files. You should really read the linked blogpost if you haven’t heard of it.</p> <p>Notice how we use the same <code>shell.nix</code> we use for local development to build our software in the CI pipeline. Isn’t that awesome? No more duplicate ways of building packages! This way, we guarantee that whatever works locally, also works on our CI.</p> <p>Now, what am I using to write this nice Dhall definition? The answer is <a href="https://github.com/regadas/github-actions-dhall">Github Actions Dhall</a>, a project by Filipe Regadas.</p> <p>In this particular example, I’m pointing at my fork, which contains the definitions of the <code>cachix/install-nix</code> and <code>cachix/cachix</code> actions. Ultimately, these changes will be available upstream, I hope.</p> <p>All we need to do to generate the required YAML file is to run the following command:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>dhall-to-yaml --file ci.dhall &gt; ci.yml</code></pre></div> <p>I know this is a bit annoying at the moment, but I’d do this 1000 times over writing YAML directly. The interesting thing is that Github could support Dhall definitions natively - I actually submitted a feature request but I don’t know if they will consider it.</p> <p>All they need to do is to have <code>dhall-json</code> installed, take in a Dhall definition and run the same <code>dhall-to-yaml</code> command. Now they can just re-use the existing infrastructure! <em>It would be fantastic if Github pulls this off</em>.</p> <h3 id="caching-derivations">Caching derivations</h3> <p><a href="https://cachix.org/">Cachix</a> is a binary cache as a service, and it is free for public caches and open-source projects. It helps speeding up your CI build as well as builds in other machines that share the same <code>shell.nix</code>.</p> <p>Its main documentation is centered around building Nix derivations, so this is what you will find:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>cachix create &lt;name&gt;
<span class="nv">$ </span>nix-build <span class="p">|</span> cachix push &lt;name&gt;
<span class="nv">$ </span>cachix use &lt;name&gt;</code></pre></div> <p>However, if we try to build our <code>shell.nix</code> file, this is what happens:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>nix-build shell.nix
these derivations will be built:
  /nix/store/7lyp4vfrrsn7rx3rwy31va2l10g4xkxq-nix-shell.drv
building <span class="s1">&#39;/nix/store/7lyp4vfrrsn7rx3rwy31va2l10g4xkxq-nix-shell.drv&#39;</span>...
nobuildPhase

This derivation is not meant to be built, aborting

builder <span class="k">for</span> <span class="s1">&#39;/nix/store/7lyp4vfrrsn7rx3rwy31va2l10g4xkxq-nix-shell.drv&#39;</span> failed with <span class="nb">exit </span>code 1
error: build of <span class="s1">&#39;/nix/store/7lyp4vfrrsn7rx3rwy31va2l10g4xkxq-nix-shell.drv&#39;</span> failed</code></pre></div> <p>Don’t worry. Cachix supports building and pushing the derivations of a Nix shell but it is currently an under-documented feature! This is how we can do it:</p> <div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>nix-shell
<span class="nv">$ </span>nix-store -qR --include-outputs <span class="k">$(</span>nix-instantiate shell.nix<span class="k">)</span> <span class="p">|</span> cachix push &lt;name&gt;</code></pre></div> <p>The first step might not be necessary if you already evaluated your shell or are using Nix Direnv.</p> <p>Once you learn how to use Cachix, you could take advantage of it on Github actions by using <a href="https://github.com/cachix/cachix-action">Cachix Action</a>, which is the action used in our Dhall file above.</p> <p>So far, I have been trying this configuration on <a href="https://github.com/gvolpe/blog">this blog</a>, on a <a href="https://github.com/profunktor/redis4cats">Scala project</a> and on a <a href="https://github.com/gvolpe/shopping-cart-haskell">Haskell project</a>. The conclusion is that for a CI build job I could probably get away without using Cachix and it’ll still be the same. However, as soon as the Nix dependencies of your project start to grow, you may notice a difference.</p> <p>Here’s a screenshot of the current size of all the caches I have defined:</p> <p><img src="../../images/cachix.png" alt="cachix" /></p> <h3 id="microsite-publishing-automation">Microsite publishing automation</h3> <p>The Redis4Cats project (Scala) is particularly interesting because I use Nix only to publish the static site (microsite) that contains the documentation. This is normally done via the command <code>sbt publishMicrosite</code>, which requires not only <code>sbt</code> and <code>openjdk</code> but also <code>jekyll</code>. Find below the definition of the <code>shell.nix</code> file:</p> <div class="highlight"><pre><code class="language-nix" data-lang="nix"><span class="k">let</span>
  <span class="ss">nixpkgs =</span> fetchTarball <span class="p">{</span>
    <span class="ss">name   =</span> <span class="s2">&quot;NixOS-unstable-13-05-2020&quot;</span><span class="p">;</span>
    <span class="ss">url    =</span> <span class="s2">&quot;https://github.com/NixOS/nixpkgs-channels/archive/6bcb1dec8ea.tar.gz&quot;</span><span class="p">;</span>
    <span class="ss">sha256 =</span> <span class="s2">&quot;04x750byjr397d3mfwkl09b2cz7z71fcykhvn8ypxrck8w7kdi1h&quot;</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="ss">pkgs =</span> <span class="nb">import</span> nixpkgs <span class="p">{};</span>
<span class="k">in</span>
  pkgs<span class="o">.</span>mkShell <span class="p">{</span>
    <span class="ss">buildInputs =</span> <span class="k">with</span> pkgs<span class="p">;</span> <span class="p">[</span>
      haskellPackages<span class="o">.</span>dhall-json <span class="c1"># 1.6.2</span>
      jekyll <span class="c1"># 4.0.1</span>
      openjdk <span class="c1"># 1.8.0_242</span>
      sbt <span class="c1"># 1.3.10</span>
    <span class="p">];</span>
  <span class="p">}</span></code></pre></div> <p>Besides this Nix shell definition, we also have a Dhall definition of the Github actions job required to automate the publishing of the microsite, only when some changes have been made to the site and is pushed to master.</p> <div class="highlight"><pre><code class="language-haskell" data-lang="haskell"><span class="kr">let</span> <span class="kt">GithubActions</span> <span class="ow">=</span>
      <span class="n">https</span><span class="kt">://</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">gvolpe</span><span class="o">/</span><span class="n">github</span><span class="o">-</span><span class="n">actions</span><span class="o">-</span><span class="n">dhall</span><span class="o">/</span><span class="n">steps</span><span class="o">/</span><span class="n">cachix</span><span class="o">/</span><span class="n">package</span><span class="o">.</span><span class="n">dhall</span> <span class="n">sha256</span><span class="kt">:</span><span class="mi">4</span><span class="n">cd8f64770d8b015c2fd52bae5ddfb5b393eb7e0936f7f8e18f311c591b888a5</span>

<span class="kr">let</span> <span class="n">setup</span> <span class="ow">=</span>
      <span class="p">[</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">checkout</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">cachix</span><span class="o">/</span><span class="n">install</span><span class="o">-</span><span class="n">nix</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">cachix</span><span class="o">/</span><span class="n">cachix</span> <span class="p">{</span> <span class="n">cache</span><span class="o">-</span><span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;scala-microsite&quot;</span> <span class="p">}</span>
      <span class="p">,</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">run</span> <span class="p">{</span> <span class="n">run</span> <span class="ow">=</span> <span class="s">&quot;nix-shell --run </span><span class="se">\&quot;</span><span class="s">sbt publishSite</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="p">}</span>
      <span class="p">]</span>

<span class="kr">in</span>  <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Workflow</span><span class="ow">::</span><span class="p">{</span>
    <span class="p">,</span> <span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;Microsite&quot;</span>
    <span class="p">,</span> <span class="n">on</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">On</span><span class="ow">::</span><span class="p">{</span>
      <span class="p">,</span> <span class="n">push</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Push</span><span class="ow">::</span><span class="p">{</span>
        <span class="p">,</span> <span class="n">branches</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="p">[</span> <span class="s">&quot;master&quot;</span> <span class="p">]</span>
        <span class="p">,</span> <span class="n">paths</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="p">[</span> <span class="s">&quot;site/**&quot;</span> <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">,</span> <span class="n">jobs</span> <span class="ow">=</span> <span class="n">toMap</span>
        <span class="p">{</span> <span class="n">publish</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="kt">Job</span><span class="ow">::</span><span class="p">{</span>
          <span class="p">,</span> <span class="n">name</span> <span class="ow">=</span> <span class="s">&quot;publish-site&quot;</span>
          <span class="p">,</span> <span class="n">needs</span> <span class="ow">=</span> <span class="kt">None</span> <span class="p">(</span><span class="kt">List</span> <span class="kt">Text</span><span class="p">)</span>
          <span class="p">,</span> <span class="n">runs</span><span class="o">-</span><span class="n">on</span> <span class="ow">=</span> <span class="kt">GithubActions</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="kt">RunsOn</span><span class="o">.</span><span class="p">`</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="p">`</span>
          <span class="p">,</span> <span class="n">steps</span> <span class="ow">=</span> <span class="n">setup</span>
          <span class="p">,</span> <span class="n">env</span> <span class="ow">=</span> <span class="kt">Some</span> <span class="p">(</span><span class="n">toMap</span> <span class="p">{</span> <span class="kt">GITHUB_TOKEN</span> <span class="ow">=</span> <span class="s">&quot;</span><span class="se">\</span><span class="err">${</span><span class="se">\</span><span class="s">{ secrets.GITHUB_TOKEN }}&quot;</span> <span class="p">})</span>
          <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></code></pre></div> <p>You can see it in action <a href="https://github.com/profunktor/redis4cats/runs/732431811">here</a>. It takes about 13 minutes because the <code>sbt publishMicrosite</code> is a slow task, not because of Nix, but the point is that this is now an automated task and I can forget about it.</p> <p>I like all this stuff a lot so I hope to adopt it in other projects quite soon.</p> <p>Cheers, Gabriel.</p> <div id="gh-comments"> <br/><br/> <div id="gh-comments-list"></div> </div> <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"> </script> <script src="/js/github-comments.js"> </script> <script type="text/javascript"> DoGithubComments ( "gvolpe/blog-comments" , "8" ); </script> <noscript>Please enable JavaScript to view comments.</noscript> </div> </div> </section> <footer id="footer"> <!-- Icons --> <!-- Look here for more brands icons: https://fortawesome.com/sets/font-awesome-5-brands --> <script src="/js/email.js"> </script> <ul class="icons"> <li><a href="#" class="icon solid fa-envelope" onclick="showContact()"><span class="label">Email</span></a></li> <li><a href="https://github.com/gvolpe" target="_blank" class="icon brands fa-github"><span class="label">Github</span></a></li> <li><a href="https://matrix.to/#/@gvolpe:matrix.org" target="_blank" class="icon brands fa-gitter"><span class="label">Matrix</span></a></li> <li><a rel="me" href="https://fosstodon.org/@gvolpe" target="_blank" class="icon brands fa-mastodon"><span class="label">Mastodon</span>></a></li> <li><a href="https://twitter.com/volpegabriel87" target="_blank" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li> <li><a href="https://bsky.app/profile/gvolpe.com" target="_blank" class="icon brands fa-dribbble"><span class="label">Bluesky</span></a></li> <li><a href="https://linkedin.com/in/gmvolpe" target="_blank" class="icon brands fa-linkedin-in"><span class="label">LinkedIn</span></a></li> <li><a href="https://leanpub.com/u/gvolpe" target="_blank" class="icon brands fa-leanpub"><span class="label">LeanPub</span></a></li> <li><a href="https://www.blurb.co.uk/user/gvolpe" target="_blank" class="icon brands fa-bimobject"><span class="label">Blurb</span></a></li> </ul> <small> Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> and by <a href="http://nandomoreira.me" target="_blank">nandomoreira.me</a> </small> <!-- Menu --> <ul class="menu"> <li> &copy; Gabriel Volpe 2020-2025 </li> </ul> </footer> </body> </html></body></html>
