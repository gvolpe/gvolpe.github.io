<!doctype html><html lang=en-us data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://gvolpe.com/images/favicon.png><title>XMonad + Polybar on NixOS - Gabriel Volpe</title><meta name=description content="I&rsquo;ve been a Gnome user for a long time and I have never cared about using a Window Manager ever before but I recently switched to using XMonad full-time. â€¦"><meta property="og:title" content="XMonad + Polybar on NixOS"><meta property="og:description" content="I&rsquo;ve been a Gnome user for a long time and I have never cared about using a Window Manager ever before but I recently switched to using XMonad full-time. â€¦"><meta property="og:type" content="article"><meta property="og:url" content="https://gvolpe.com/blog/xmonad-polybar-nixos/"><meta property="og:site_name" content="Gabriel Volpe"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="XMonad + Polybar on NixOS"><meta name=twitter:description content="I&rsquo;ve been a Gnome user for a long time and I have never cared about using a Window Manager ever before but I recently switched to using XMonad full-time. â€¦"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@400;500&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><link rel=stylesheet href=https://gvolpe.com/css/style.css><script type=text/javascript defer data-domain=gvolpe.com data-api=analytics.gvolpe.com src=https://gvolpe.com/js/plausible.js></script></head><body><main><div id=post-overlay-id class="post-overlay active"><div class=reading-progress></div><div class=post-overlay-backdrop></div><div id=post-overlay-content-id class=post-overlay-content style=position:relative;min-height:100vh;padding:0;transform:translateY(0)><div class=post-overlay-header><div class=post-overlay-title><a href=/ class=overlay-site-title>Gabriel Volpe</a></div><button class=post-overlay-close aria-label="Close post" onclick='window.location.href="/"'>
<i class="fas fa-times"></i></button></div><div class=post-layout><article class=post-content><header class=post-header><div class=post-meta><span class=post-date>2020.11.25</span><div class=reading-time-post><span class=coffee-cups>ðŸ“šðŸ“šðŸ“šðŸ“šðŸ“š
</span><span>14 min read</span></div></div><h1 class=post-title>XMonad + Polybar on NixOS</h1><div class=post-tags-header><a href=https://gvolpe.com/tags/nix class=post-tag>nix</a>
<a href=https://gvolpe.com/tags/nixos class=post-tag>nixos</a>
<a href=https://gvolpe.com/tags/xmonad class=post-tag>xmonad</a>
<a href=https://gvolpe.com/tags/polybar class=post-tag>polybar</a>
<a href=https://gvolpe.com/tags/wm class=post-tag>wm</a>
<a href=https://gvolpe.com/tags/windowmanager class=post-tag>windowmanager</a></div></header><div class=post-body><p>I&rsquo;ve been a <a href=https://www.gnome.org/>Gnome</a> user for a long time and I have never cared about using a <a href=https://en.wikipedia.org/wiki/Window_manager>Window Manager</a> ever before but I recently switched to using <a href=https://xmonad.org/>XMonad</a> full-time. Why? For a couple of reasons.</p><p>One of the reasons is that I&rsquo;ve been wanting to try a lightweight window manager for a while. However, the main reason is that Gnome <em>leaks memory</em>, unfortunately, and it seems to be an issue that&rsquo;s been around <a href=https://bugs.launchpad.net/gnome-shell/+bug/1672297>forever</a>. Although it has been announced as allegedly solved, I have been experiencing a similar issue in Gnome 3.36 on <a href=https://nixos.org/>NixOS</a>.</p><p>After a fresh start, it consumed ~1.2% of my 32GB (about 390MB) but right after 24 hours (only one day of uptime!) I found out it was consuming ~50% (about 16GB!), which is unacceptable. I have screenshots of the memory consumption but I decided to leave them out of this post since it is not about bashing Gnome.</p><p>I know writing solid software is hard and memory leaks are one of the toughest problems to solve in Software Engineering so I only want to thank Gnome for all the good years and wish only the best. My mother still uses Gnome 3 with Ubuntu, FWIW :)</p><p>The good news is that this incident has pushed me into giving XMonad a serious try, and oh boy, there&rsquo;s no way back! It&rsquo;s like that day I discovered functional programming. How could I ever write imperative code again?</p><p><strong>NOTE</strong>: if you&rsquo;re already familiar with this and are only interested in the configuration files, you can find them <a href=https://github.com/gvolpe/nix-config>here</a>.</p><h3 id=xmonad>XMonad</h3><p>XMonad is a dynamically tiling <a href=https://en.wikipedia.org/wiki/X_Window_System>X11</a> window manager that is written and configured in <a href=https://www.haskell.org/>Haskell</a>. There are many tutorials, blog posts, videos and documentation on the Internet about it so I&rsquo;m only going to focus on getting XMonad properly set up in NixOS.</p><p>This is what it looks like at the moment on my machine (it&rsquo;s always evolving).</p><p><img src=../../images/xmonad.jpg alt=xmonad></p><p>That&rsquo;s not only XMonad but also <a href=https://polybar.github.io/>Polybar</a> and <a href=https://github.com/yshui/picom>Picom</a> complementing it, a status bar and a compositor, respectively.</p><p>If you, like me, come from a popular desktop manager such as Gnome or KDE, you might be surprised finding out all the things they do! Since XMonad is merely a window manager, you won&rsquo;t have out-of-box support for a status bar, notifications, screen locker, etc. This follows the Unix philosophy where we are free to choose how every piece of our software is put together.</p><p>In the next sections, we will look into every piece of software I have configured to get the full desktop manager experience.</p><h4 id=configuration>Configuration</h4><p>I configure all my software and user services via <a href=https://github.com/nix-community/home-manager>Home Manager</a>, an amazing Nix tool. It&rsquo;s great on NixOS but it also works in other Linux distros, if you want to give it a shot.</p><p>However, some programs and services need to be declared at the system level, which is also the case for XMonad. So we will start with it.</p><p>All configuration files live under <code>/etc/nixos/</code> and <code>~/.config/nixpkgs/</code> for system-level configuration and user-level configuration, respectively. Therefore, only the relative path will be mentioned in the following sections.</p><h4 id=system-level>System level</h4><p>I&rsquo;ve defined the XMonad system configuration under <code>wm/xmonad.nix</code>, and I&rsquo;ve done pretty much the same with my Gnome configuration, so it would be easy to switch between both.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> lib<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    gnome3<span style=color:#f92672>.</span>gnome-keyring<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    upower<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dbus <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      socketActivated <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      packages <span style=color:#f92672>=</span> [ pkgs<span style=color:#f92672>.</span>gnome3<span style=color:#f92672>.</span>dconf ];
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    xserver <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      startDbusSession <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      layout <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;us&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      libinput <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        disableWhileTyping <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      displayManager<span style=color:#f92672>.</span>defaultSession <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;none+xmonad&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      windowManager<span style=color:#f92672>.</span>xmonad <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        enableContribAndExtras <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      xkbOptions <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;caps:ctrl_modifier&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  hardware<span style=color:#f92672>.</span>bluetooth<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>blueman<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  systemd<span style=color:#f92672>.</span>services<span style=color:#f92672>.</span>upower<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There is a lot declared in this file that is completely unrelated to it but that complements it.</p><ul><li><code>gnome3.gnome-keyring</code>: needed to store credentials such as WiFi passwords, so we don&rsquo;t need to enter it every time we log in.</li><li><code>upower</code>: get system&rsquo;s power information such as CPU usage. We also need the <code>systemd</code> daemon.</li><li><code>dbus</code>: short for Desktop Bus, allows concurrent communication between multiple processes and it&rsquo;s kind of ubiquitous these days.</li><li><code>bluetooth</code>: enable bluetooth.</li><li><code>blueman</code>: enable the bluetooth manager service.</li></ul><p>For what it&rsquo;s worth, all of these are enabled by default when using either Gnome or KDE.</p><p>The rest of the configuration is part of <code>xserver</code>, in which case, we need to highlight the default session of our display manager being set to <code>none+xmonad</code> and enabling XMonad as our window manager. The <code>none</code> part means we don&rsquo;t want any Desktop Environment (DE), which defaults to <code>xfce</code> in NixOS, if I&rsquo;m not mistaken.</p><p>This file is then imported at <code>configuration.nix</code>, which is the main NixOS configuration file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{
</span></span><span style=display:flex><span>  imports <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    [
</span></span><span style=display:flex><span>      <span style=color:#75715e># Include the results of the hardware scan.</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>./hardware-configuration.nix</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Machine-specific configuration</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>./machine/current.nix</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Window manager</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>./wm/xmonad.nix</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A regular <code>nixos-rebuild switch</code> followed by a <code>reboot</code> are needed for all these changes to become active.</p><h4 id=user-level>User level</h4><p>User-level configuration includes all the dotfiles that usually live under <code>$HOME/.config</code> as well as user-level services managed via <code>systemctl</code>. This is the perfect fit for Home Manager (HM). For reference, this is how the files are organized.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span>.
</span></span><span style=display:flex><span>â”œâ”€â”€ config.nix
</span></span><span style=display:flex><span>â”œâ”€â”€ home.nix
</span></span><span style=display:flex><span>â”œâ”€â”€ overlays
</span></span><span style=display:flex><span>â”œâ”€â”€ programs
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ alacritty
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ browsers
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ fish
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ git
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ neovim
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ rofi
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ xmonad
</span></span><span style=display:flex><span>â”œâ”€â”€ services
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ dunst
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ gpg-agent
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ networkmanager
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ picom
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ polybar
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ screenlocker
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ udiskie
</span></span><span style=display:flex><span>â””â”€â”€ unstable.nix
</span></span></code></pre></div><p>Every folder has a <code>default.nix</code> we import in <code>home.nix</code>. So, for example, the configuration for XMonad lives under <code>programs/xmonad/default.nix</code>, and so on. Its definition is shown below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{
</span></span><span style=display:flex><span>  xsession <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    initExtra <span style=color:#f92672>=</span> polybarOpts;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    windowManager<span style=color:#f92672>.</span>xmonad <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      enableContribAndExtras <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>      extraPackages <span style=color:#f92672>=</span> hp: [
</span></span><span style=display:flex><span>        hp<span style=color:#f92672>.</span>dbus
</span></span><span style=display:flex><span>        hp<span style=color:#f92672>.</span>monad-logger
</span></span><span style=display:flex><span>        hp<span style=color:#f92672>.</span>xmonad-contrib
</span></span><span style=display:flex><span>      ];
</span></span><span style=display:flex><span>      config <span style=color:#f92672>=</span> <span style=color:#e6db74>./config.hs</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We will later see how <code>polybarOpts</code> is defined and whether that&rsquo;s needed for you or not. This file is then imported by <code>home.nix</code>, in the same way we do it at the system level.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> lib<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> stdenv<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  programs<span style=color:#f92672>.</span>home-manager<span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  imports <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>./programs/xmonad/default.nix</span>
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In general, all the programs and user-level services are imported in this way, to keep the modularity.</p><h3 id=rofi>Rofi</h3><p>Right after XMonad is installed, having an application launcher (recommended) might be very convenient to have. Otherwise, the only way to run applications will be directly from a terminal, which is not the nicest experience for GUI programs. This is where tools such as <a href=https://tools.suckless.org/dmenu/>dmenu</a> and <a href=https://github.com/davatorium/rofi>Rofi</a> come into place.</p><p>The former has been around for a long time and it&rsquo;s a good default but after trying out both, I&rsquo;ve settled for Rofi, which is a modern replacement for <code>dmenu</code>. You can customize its look and feel as you please and there are a few themes to select from if you prefer something already made.</p><p>Here&rsquo;s how it looks on my machine.</p><p><img src=../../images/rofi.png alt=rofi></p><p>I use a customized version of the <a href=https://github.com/davatorium/rofi/blob/next/themes/arthur.rasi>Arthur theme</a>. Here&rsquo;s how to import it using Home Manager.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  programs<span style=color:#f92672>.</span>rofi <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    terminal <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>alacritty<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/alacritty&#34;</span>;
</span></span><span style=display:flex><span>    theme <span style=color:#f92672>=</span> <span style=color:#e6db74>./theme.rafi</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=polybar>Polybar</h3><p>When I got started with XMonad, I&rsquo;ve tried <a href=https://xmobar.org/>XMobar</a> first, which is the default status bar you would see recommended for this window manager. Later on, I gave <a href=https://github.com/taffybar/taffybar>taffybar</a> a try, but it was a bit painful to set up since I needed to add two Nix overlays to get it working as it is usually marked as broken on Nixpkgs.</p><p>Both of them work fine and might suit your needs (I still keep the configuration files for both in my repo, if you&rsquo;re interested) but I ultimately fell in love with <a href=https://polybar.github.io/>Polybar</a>. I am actually running two instances of it: one at the top; another at the bottom. There are many existing themes, great documentation and a vibrant community behind it, which makes it even more appealing.</p><p>It is configured via <a href=https://en.wikipedia.org/wiki/INI_file>INI files</a>. Here&rsquo;s a snippet.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[global/wm]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>margin-top</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>margin-bottom</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[bar/main]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>monitor</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>${env:MONITOR:HDMI-1}</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>width</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>100%</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>height</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>48</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>radius</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>6.0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>fixed-center</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>true</span>
</span></span></code></pre></div><p>It comes packed with a few modules by default such as CPU, memory and network status. However, some modules might require some software to be available in your system. I&rsquo;ll leave that for you to further read and instead I&rsquo;ll show you the important part:</p><ul><li>XMonad integration to visualize the current window title and workspaces.</li><li>Dealing with modules that require custom scripts doing it the Nix way.</li></ul><p>Here&rsquo;s my configuration, which runs as a service you can manage via <code>systemctl</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  mypolybar <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>polybar<span style=color:#f92672>.</span>override {
</span></span><span style=display:flex><span>    alsaSupport   <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    githubSupport <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    mpdSupport    <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    pulseSupport  <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># theme adapted from: https://github.com/adi1090x/polybar-themes#-polybar-5</span>
</span></span><span style=display:flex><span>  bars   <span style=color:#f92672>=</span> builtins<span style=color:#f92672>.</span>readFile <span style=color:#e6db74>./bars.ini</span>;
</span></span><span style=display:flex><span>  colors <span style=color:#f92672>=</span> builtins<span style=color:#f92672>.</span>readFile <span style=color:#e6db74>./colors.ini</span>;
</span></span><span style=display:flex><span>  mods1  <span style=color:#f92672>=</span> builtins<span style=color:#f92672>.</span>readFile <span style=color:#e6db74>./modules.ini</span>;
</span></span><span style=display:flex><span>  mods2  <span style=color:#f92672>=</span> builtins<span style=color:#f92672>.</span>readFile <span style=color:#e6db74>./user_modules.ini</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mprisScript     <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>callPackage <span style=color:#e6db74>./scripts/mpris.nix</span> {};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  mpris <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [module/mpris]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    type = custom/script
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    exec = </span><span style=color:#e6db74>${</span>mprisScript<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/mpris
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tail = true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    label-maxlen = 60
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    interval = 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    format = ï†¼  &lt;label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    format-padding = 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  xmonad <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    [module/xmonad]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    type = custom/script
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    exec = </span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>xmonad-log<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/xmonad-log
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    tail = true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>polybar <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    package <span style=color:#f92672>=</span> mypolybar;
</span></span><span style=display:flex><span>    config <span style=color:#f92672>=</span> <span style=color:#e6db74>./config.ini</span>;
</span></span><span style=display:flex><span>    extraConfig <span style=color:#f92672>=</span> bars <span style=color:#f92672>+</span> colors <span style=color:#f92672>+</span> mods1 <span style=color:#f92672>+</span> mods2 <span style=color:#f92672>+</span> mpris <span style=color:#f92672>+</span> xmonad;
</span></span><span style=display:flex><span>    script <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      polybar top &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      polybar bottom &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As mentioned above, I&rsquo;m running two different bars, as the <code>script</code> section shows.</p><p>For the XMonad integration, we only need to add <code>[module/xmonad]</code>. If we were not using Nix, this could have been defined in the INI files but since we are on NixOS, we do it properly by referencing the binary we want to run from this module, which is <code>xmonad-log</code>. We also need to do our part in our XMonad configuration, to make sure it sends out information via DBus.</p><p>This is most of the code. You can find the complete configuration on my <a href=https://github.com/gvolpe/nix-config/blob/master/home/programs/xmonad/config.hs>Github</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell><span style=display:flex><span><span style=color:#a6e22e>mkDbusClient</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>IO</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span><span style=color:#66d9ef>Client</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>mkDbusClient</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  dbus <span style=color:#f92672>&lt;-</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>connectSession
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>requestName dbus (<span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>busName_ <span style=color:#e6db74>&#34;org.xmonad.log&#34;</span>) opts
</span></span><span style=display:flex><span>  return dbus
</span></span><span style=display:flex><span> <span style=color:#66d9ef>where</span>
</span></span><span style=display:flex><span>  opts <span style=color:#f92672>=</span> [<span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>nameAllowReplacement, <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>nameReplaceExisting, <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>nameDoNotQueue]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Emit a DBus signal on log updates</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dbusOutput</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span><span style=color:#66d9ef>Client</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>String</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>IO</span> ()
</span></span><span style=display:flex><span><span style=color:#a6e22e>dbusOutput</span> dbus str <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> opath  <span style=color:#f92672>=</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>objectPath_ <span style=color:#e6db74>&#34;/org/xmonad/Log&#34;</span>
</span></span><span style=display:flex><span>      iname  <span style=color:#f92672>=</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>interfaceName_ <span style=color:#e6db74>&#34;org.xmonad.Log&#34;</span>
</span></span><span style=display:flex><span>      mname  <span style=color:#f92672>=</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>memberName_ <span style=color:#e6db74>&#34;Update&#34;</span>
</span></span><span style=display:flex><span>      signal <span style=color:#f92672>=</span> (<span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>signal opath iname mname)
</span></span><span style=display:flex><span>      body   <span style=color:#f92672>=</span> [<span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>toVariant <span style=color:#f92672>$</span> <span style=color:#66d9ef>UTF8</span><span style=color:#f92672>.</span>decodeString str]
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>in</span>  <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>emit dbus <span style=color:#f92672>$</span> signal { <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span>signalBody <span style=color:#f92672>=</span> body }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>polybarHook</span> <span style=color:#f92672>::</span> <span style=color:#66d9ef>D</span><span style=color:#f92672>.</span><span style=color:#66d9ef>Client</span> <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>PP</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>polybarHook</span> dbus <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>let</span> wrapper c s <span style=color:#f92672>|</span> s <span style=color:#f92672>/=</span> <span style=color:#e6db74>&#34;NSP&#34;</span> <span style=color:#f92672>=</span> wrap (<span style=color:#e6db74>&#34;%{F&#34;</span> <span style=color:#f92672>&lt;&gt;</span> c <span style=color:#f92672>&lt;&gt;</span> <span style=color:#e6db74>&#34;} &#34;</span>) <span style=color:#e6db74>&#34; %{F-}&#34;</span> s
</span></span><span style=display:flex><span>                  <span style=color:#f92672>|</span> otherwise  <span style=color:#f92672>=</span> mempty
</span></span><span style=display:flex><span>      blue   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#2E9AFE&#34;</span>
</span></span><span style=display:flex><span>      gray   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#7F7F7F&#34;</span>
</span></span><span style=display:flex><span>      orange <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#ea4300&#34;</span>
</span></span><span style=display:flex><span>      purple <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#9058c7&#34;</span>
</span></span><span style=display:flex><span>      red    <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;#722222&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>in</span>  def { ppOutput          <span style=color:#f92672>=</span> dbusOutput dbus
</span></span><span style=display:flex><span>          , ppCurrent         <span style=color:#f92672>=</span> wrapper blue
</span></span><span style=display:flex><span>          , ppVisible         <span style=color:#f92672>=</span> wrapper gray
</span></span><span style=display:flex><span>          , ppUrgent          <span style=color:#f92672>=</span> wrapper orange
</span></span><span style=display:flex><span>          , ppHidden          <span style=color:#f92672>=</span> wrapper gray
</span></span><span style=display:flex><span>          , ppHiddenNoWindows <span style=color:#f92672>=</span> wrapper red
</span></span><span style=display:flex><span>          , ppTitle           <span style=color:#f92672>=</span> shorten <span style=color:#ae81ff>100</span> <span style=color:#f92672>.</span> wrapper purple
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>myPolybarLogHook</span> dbus <span style=color:#f92672>=</span> myLogHook <span style=color:#f92672>&lt;+&gt;</span> dynamicLogWithPP (polybarHook dbus)
</span></span></code></pre></div><p>Now for other custom scripts, you can do the same. Above we see <code>[module/mpris]</code>, which is a shell script that reads the current song being played via <code>playerctl</code>. It is also defined the Nix way, as shown below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span>}:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  pctl <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>playerctl<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/playerctl&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>  pkgs<span style=color:#f92672>.</span>writeShellScriptBin <span style=color:#e6db74>&#34;mpris&#34;</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    echo $(</span><span style=color:#e6db74>${</span>pctl<span style=color:#e6db74>}</span><span style=color:#e6db74> --player=spotify,%any metadata --format &#39;{{ artist }} - {{ title }}&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#39;&#39;</span>
</span></span></code></pre></div><p>Another important setting you might need, depending on your modules, is to add a proper font and icons package to your user packages. This is what I have, for example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span><span style=color:#66d9ef>let</span>
</span></span><span style=display:flex><span>  polybarPkgs <span style=color:#f92672>=</span> <span style=color:#66d9ef>with</span> pkgs; [
</span></span><span style=display:flex><span>    font-awesome-ttf      <span style=color:#75715e># awesome fonts</span>
</span></span><span style=display:flex><span>    material-design-icons <span style=color:#75715e># fonts with glyphs</span>
</span></span><span style=display:flex><span>  ];
</span></span><span style=display:flex><span><span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>  home<span style=color:#f92672>.</span>packages <span style=color:#f92672>=</span> polybarPkgs;
</span></span></code></pre></div><h3 id=dunst>Dunst</h3><p><a href=https://dunst-project.org/>Dunst</a> is a lightweight replacement for the notification daemons provided by most desktop environments. It&rsquo;s very customizable, isn&rsquo;t dependent on any toolkits, and therefore fits into those window manager centric setups we all love to customize to perfection.</p><p>That&rsquo;s a quote from the official site. It also runs a service, and here&rsquo;s a snippet showing how it is integrated via Home Manager.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ config<span style=color:#f92672>,</span> pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>dunst <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    iconTheme <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Adwaita&#34;</span>;
</span></span><span style=display:flex><span>      package <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>gnome3<span style=color:#f92672>.</span>adwaita-icon-theme;
</span></span><span style=display:flex><span>      size <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;16x16&#34;</span>;
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    settings <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>      global <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        monitor <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        geometry <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;600x50-50+65&#34;</span>;
</span></span><span style=display:flex><span>        shrink <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;yes&#34;</span>;
</span></span><span style=display:flex><span>        transparency <span style=color:#f92672>=</span> <span style=color:#ae81ff>10</span>;
</span></span><span style=display:flex><span>        padding <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>        horizontal_padding <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>;
</span></span><span style=display:flex><span>        font <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;JetBrainsMono Nerd Font 10&#34;</span>;
</span></span><span style=display:flex><span>        line_height <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>        format <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;&lt;b&gt;%s&lt;/b&gt;\n%b&#39;&#39;</span>;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I haven&rsquo;t tried any other notification system and I haven&rsquo;t been made aware of a better choice but if you do, please let me know. I always like to try new things.</p><h3 id=betterlockscreen>Betterlockscreen</h3><p>If you want to configure a screen locker, you&rsquo;ll find there are quite a few alternatives out there, with <a href=https://i3wm.org/i3lock/>i3lock</a> being probably the most popular option. I&rsquo;ve tried a few variants of it but I finally settled for <a href=https://github.com/pavanjadhaw/betterlockscreen>betterlockscreen</a>, which is also built on top of <code>i3lock</code>.</p><p>It runs as a service as well. Here&rsquo;s my configuration, without much further ado.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{ pkgs<span style=color:#f92672>,</span> <span style=color:#f92672>...</span> }:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>screen-locker <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    inactiveInterval <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>;
</span></span><span style=display:flex><span>    lockCmd <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>pkgs<span style=color:#f92672>.</span>betterlockscreen<span style=color:#e6db74>}</span><span style=color:#e6db74>/bin/betterlockscreen -l dim&#34;</span>;
</span></span><span style=display:flex><span>    xautolockExtraOptions <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;Xautolock.killer: systemctl suspend&#34;</span>
</span></span><span style=display:flex><span>    ];
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=picom>Picom</h3><p>What exactly is a compositor? According to <a href=https://en.wikipedia.org/wiki/Compositing_window_manager>Wikipedia</a>, a compositing window manager, or compositor, is a window manager that provides applications with an off-screen buffer for each window. The window manager composites the window buffers into an image representing the screen and writes the result into the display memory.</p><p><a href=https://github.com/yshui/picom>picom</a> is probably the indisputable default these days, which is a fork of <code>compton</code>, which is also a fork of the original <code>xcompmgr</code>, both &ldquo;retired&rdquo; projects.</p><p>It shouldn&rsquo;t come as a surprise that it also runs a service. Here&rsquo;s my configuration.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>picom <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    activeOpacity <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1.0&#34;</span>;
</span></span><span style=display:flex><span>    inactiveOpacity <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.8&#34;</span>;
</span></span><span style=display:flex><span>    backend <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;glx&#34;</span>;
</span></span><span style=display:flex><span>    fade <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    fadeDelta <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
</span></span><span style=display:flex><span>    opacityRule <span style=color:#f92672>=</span> [ <span style=color:#e6db74>&#34;100:name *= &#39;i3lock&#39;&#34;</span> ];
</span></span><span style=display:flex><span>    shadow <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    shadowOpacity <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.75&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=system-tray>System tray</h3><p>If you use programs like Slack or Telegram, you might appreciate a system tray for them. This is something we also need to take care about. When using XMobar or Taffybar, people usually go for <a href=http://stalonetray.sourceforge.net/>standalonetray</a>, which is fairly basic. Conversely, Polybar users don&rsquo;t need to worry about it as it comes with a nice system tray by default.</p><p>The configuration for my system tray is fairly basic. I keep it in the center of my top bar.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>tray-padding</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>3</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-background</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>${color.bg}</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-detached</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>false</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-maxsize</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>6</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-offset-x</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-offset-y</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-padding</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-scale</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1.0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[bar/top]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>inherit</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>bar/main</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-position</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>center</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[bar/bottom]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>inherit</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>bar/main</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>bottom</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>true</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>tray-position</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>none</span>
</span></span></code></pre></div><p>At the beginning of the user level section, I briefly mentioned the use of <code>polybarOpts</code> as an option to <code>xsession.initExtra</code>. This is how it is defined.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>polybarOpts <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  nitrogen --restore &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  pasystray &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  blueman-applet &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  nm-applet --sm-disable --indicator &amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;&#39;</span>;
</span></span></code></pre></div><p>I basically start up some utilities that run in the system tray such as Pulse Audio (<code>pasystray</code>), Bluetooth Manager (<code>blueman-applet</code>) and Network Manager (<code>nm-applet</code>). There&rsquo;s also <code>nitrogen</code> to restore my wallpaper. Some other folks prefer to use <a href=https://feh.finalrewind.org/>feh</a>. I would use any of them, to be fair, no big preferences.</p><p>It might also be relevant to set up a GTK theme. This is what I have defined in my <code>home.nix</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>gtk <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>  iconTheme <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Adwaita-dark&#34;</span>;
</span></span><span style=display:flex><span>    package <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>gnome3<span style=color:#f92672>.</span>adwaita-icon-theme;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>  theme <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Adwaita-dark&#34;</span>;
</span></span><span style=display:flex><span>    package <span style=color:#f92672>=</span> pkgs<span style=color:#f92672>.</span>gnome3<span style=color:#f92672>.</span>adwaita-icon-theme;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=udiskie>Udiskie</h3><p>Since we talked about our system tray, there&rsquo;s also <a href=https://github.com/coldfix/udiskie>udiskie</a>, which is quite popular. It shows information about removable media and it automounts them by default.</p><p>We could have started up as part of our XSession but since Home Manager supports running it as a service, I went with it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nix data-lang=nix><span style=display:flex><span>{
</span></span><span style=display:flex><span>  services<span style=color:#f92672>.</span>udiskie <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    tray <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;always&#34;</span>;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Home Manager also supports starting up the <a href=https://rycee.gitlab.io/home-manager/options.html#opt-services.network-manager-applet.enable>Network Manager applet</a> as a service but at the moment of writing, it doesn&rsquo;t support customized flags, so I run it manually in my XSession.</p><h3 id=conclusion>Conclusion</h3><p>Wow, we went through a lot of stuff! This is actually a big part of my current NixOS configuration. I hope you have enjoyed the details since when I started playing around with all of it, the information was pretty much scattered around the Internet and I had to figure out a lot of things by trial and error.</p><p>These settings will probably keep on changing but I&rsquo;m already in a very comfortable place with my current configuration so I don&rsquo;t expect drastic changes in the near future but rather small improvements.</p><p>My full NixOS configuration, including the programs and services managed by Home Manager, can be found on <a href=https://github.com/gvolpe/nix-config>Github</a>.</p><p>Cheers,
Gabriel.</p></div><div id=gh-comments><div id=gh-comments-list></div></div><script src=https://code.jquery.com/jquery-3.2.1.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://gvolpe.com/js/github-comments.js></script><script type=text/javascript>DoGithubComments("gvolpe/blog-comments","10")</script><noscript>Please enable JavaScript to view comments.</noscript><div class=related-posts><h3>Related Content</h3><div class=related-grid><div class=related-post><h4><a href=https://gvolpe.com/blog/gnome3-on-nixos/>Gnome 3 on NixOS</a></h4><div class=related-meta>2020.07.01 â€¢
ðŸ“šðŸ“šðŸ“šðŸ“š 4 min read</div></div><div class=related-post><h4><a href=https://gvolpe.com/blog/github-actions-nix-cachix-dhall/>Github actions powered by Nix Shell & Cachix</a></h4><div class=related-meta>2020.06.02 â€¢
ðŸ“šðŸ“šðŸ“šðŸ“šðŸ“š 7 min read</div></div><div class=related-post><h4><a href=https://gvolpe.com/talks/nixcon-2020/>Nix at Chatroulette @ Nixcon 2020 - Online ðŸŒŽ</a></h4><div class=related-meta>2020.10.01 â€¢
ðŸŽ™ï¸ Public Talk</div></div></div></div><nav class=post-navigation><div class=nav-previous><span class=nav-label>â† Previous</span>
<a href=https://gvolpe.com/blog/gnome3-on-nixos/ class=nav-title>Gnome 3 on NixOS</a></div><div class=nav-next><span class=nav-label>Next â†’</span>
<a href=https://gvolpe.com/blog/fsm-fs2-a-match-made-in-heaven/ class=nav-title>Finite-State Machines + FS2 streams: A match made in heaven</a></div></nav></article><aside class=sidebar><nav class=toc><h4>Contents</h4><div id=toc-content></div></nav></aside></div></div></div></main><script src=https://gvolpe.com/js/main.js></script></body></html>