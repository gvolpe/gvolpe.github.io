{{ define "main" }}
<!-- Full-screen post layout to match SPA overlay -->
<div id="post-overlay-id" class="post-overlay active">
    {{ if eq .Type "blog" }}
    <div class="reading-progress"></div>
    {{ end }}

    <div class="post-overlay-backdrop"></div>
    <div id="post-overlay-content-id" class="post-overlay-content" style="position: relative; min-height: 100vh; padding: 0; transform: translateY(0);">
        <div class="post-overlay-header">
            <div class="post-overlay-title">
                <a href="/" class="overlay-site-title">{{ .Site.Title }}</a>
            </div>
            <button class="post-overlay-close" aria-label="Close post" onclick="window.location.href='/'">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="post-layout">
        <article class="post-content">
            <header class="post-header">
                <div class="post-meta">
                    <span class="post-date">{{ .Date.Format "2006.01.02" }}</span>
                    {{ if eq .Type "blog" }}
                    <div class="reading-time-post">
                        <span class="coffee-cups">
                            {{ $coffees := "" }}
                            {{ $maxCups := 5 }}
                            {{ $cupsToShow := .ReadingTime }}
                            {{ if gt .ReadingTime $maxCups }}
                                {{ $cupsToShow = $maxCups }}
                            {{ end }}
                            {{ range (seq $cupsToShow) }}
                                {{ $coffees = print $coffees "üìö" }}
                            {{ end }}
                            {{ $coffees }}
                        </span>
                        <span>{{ .ReadingTime }} min read</span>
                    </div>
                    {{ end }}
                </div>
                <h1 class="post-title">{{ .Title }}</h1>
                {{ if .Params.subtitle }}
                <p class="post-subtitle">{{ .Params.subtitle }}</p>
                {{ end }}

                {{ if .Params.tags }}
                <div class="post-tags-header">
                    {{ range .Params.tags }}
                    <a href="{{ "/tags/" | absLangURL }}{{ . | urlize }}" class="post-tag">{{ . }}</a>
                    {{ end }}
                </div>
                {{ end }}
            </header>
            <div class="post-body">
                {{ .Content }}
            </div>

            {{ partial "github-comments.html" . }}

            {{ $related := .Site.RegularPages.Related . | first 3 }}
            {{ with $related }}
            <div class="related-posts">
                <h3>Related Content</h3>
                <div class="related-grid">
                    {{ range . }}
                    <div class="related-post">
                        <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
                        <div class="related-meta">
                            {{ .Date.Format "2006.01.02" }} ‚Ä¢
                            {{ if eq .Section "blog" }}
                              {{ $coffees := "" }}
                              {{ $maxCups := 5 }}
                              {{ $cupsToShow := .ReadingTime }}
                              {{ if gt .ReadingTime $maxCups }}{{ $cupsToShow = $maxCups }}{{ end }}
                              {{ range (seq $cupsToShow) }}{{ $coffees = print $coffees "üìö" }}{{ end }}
                              {{ $coffees }} {{ .ReadingTime }} min read
                            {{ else }}
                              üéôÔ∏è Public Talk
                            {{ end }}
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
            {{ end }}

            <!-- Post Navigation (Prev/Next) -->
            <nav class="post-navigation">
                {{ with .PrevInSection }}
                <div class="nav-previous">
                    <span class="nav-label">‚Üê Previous</span>
                    <a href="{{ .Permalink }}" class="nav-title">{{ .Title }}</a>
                </div>
                {{ else }}
                <div></div>
                {{ end }}

                {{ with .NextInSection }}
                <div class="nav-next">
                    <span class="nav-label">Next ‚Üí</span>
                    <a href="{{ .Permalink }}" class="nav-title">{{ .Title }}</a>
                </div>
                {{ else }}
                <div></div>
                {{ end }}
            </nav>
        </article>

        {{ if eq .Type "blog" }}
        <aside class="sidebar">
            <nav class="toc">
                <h4>Contents</h4>
                <div id="toc-content">
                    <!-- TOC will be generated by JavaScript -->
                </div>
            </nav>
        </aside>
        {{ end }}
        </div>
    </div>
</div>
{{ end }}
